

# SightCall iOS SDK

This SDK is dedicated to Sightcall customers. It is designed to be integrated into your existing app flow and bring seamless access to the Sightcall experience.

> NOTE: To fully utilize this SDK you must be a registered client with SightCall.
>

## Overview

SightCall makes it easy for a user in the field to communicate and share video with a remote company agent. Typically the agent will direct the experience manipulating camera controls using Augmented Reality overlays and a visual markers to assist the user in their task.

The SightCallSDK is designed to enable you, the developer, to easily integrate this capability into your applications.

## Account Setup

> NOTE: Apple's Safari Browser is NOT currently supported, use Firefox or Chrome instead and install the SigghtCall browser plugin as directed.
>

#### SightCall Account

Log into https://admin.sightcall.com/ and create a `agent user` and `use case`.

TODO: Visual aid

- Admin: TENANT: Users: Desktop Agents
- Admin: TENANT: Use Cases: Use Cases CODE
  - Use Case Name: "Show Me"
  - Code Options: all
  - Pin code page: No
  - Code auto deleted: No

#### SightCall Session Invitation URL

A SightCall invitation URL is generated by the Agent and sent to the user by email or SMS. If the PIN is not included with the URL (as set by the `Pin code page` option) then it must be transimitted to the user by other means.

TODO: Visual aid

```
// NO Pin
// https://<your.domain>/call/<sight_call_use_case_id>
https://guest.sightcall.com/call/b7cdc700d817ddf86f143675340d0f7a15b461010

// Pin Included
// https://<your.domain>/call/<sight_call_use_case_id>?pin=<session_id>
https://guest.sightcall.com/call/b7cdc700d817ddf86f143675340d0f7a15b461010?pin=123456
```

> NOTE: Your domain must be properly configured to support Apple Deeplinks for the URL to be handed off to your application. If you are testing using the `guest.sightcall.com` domain then you can use the pasteboard to avoid having to manually enter the URL into your application.
>

## Project Configuration

### Installation with CocoaPods

[CocoaPods](https://cocoapods.org/) is the easiest way to get started (if you're new to CocoaPods, check out their [getting started documentation](https://guides.cocoapods.org/using/getting-started.html).)

To integrate the Sightcall sdk into your Xcode project using CocoaPods, specify it in your `Podfile`:

```shell
    pod 'LSUniversalSDK', :git => 'https://github.com/sightcall/iOS-UniversalSDK.git'
```

### Xcode Configuration

Once you have created your project you will need to set a number of application settings.

#### Permissions

The Framework requires some permissions to be used and must be set in the App's `Info.plist`.

* **NSLocationWhenInUseUsageDescription** This permission is used in response to an Agent's request.

* **NSCameraUsageDescription**This permission is required for starting the video capture. I

* **NSMicrophoneUsageDescription**This permission is required for starting the audio capture. 

* **NSPhotoLibraryUsageDescription** This permission is required for sharing images from the gallery.

#### Entitlements

##### Universal link

In order to setup universal link, some domains should be added to the **Associated Domains** section (in Signing and  Capabilities of your target). 
Common domains are usually: 

* **applinks:guest.sightcall.com**
* **applinks:guest-ppr.sightcall.com**

> Note: Depending on your use case, you may need specific domains. Don't forget to ask your SightCall contact for them.

##### Deeplink

When user comes from the guest webpage, a deeplink can be displayed to open your application. So, at least, one scheme should be added to the [**URL Types**](https://coderwall.com/p/mtjaeq/ios-custom-url-scheme) section (in Info section of your target). 
Common scheme is: **sightcall**

> Note: Depending on your use case, you may need specific schemes. Don't forget to ask your SightCall contact for them.

#### Background Modes

If you need to be able to continue the call on background, you should setup the associated section (in Signing and  Capabilities of your target, then **Background Modes**):

* **Audio, AirPlay, and Picture in Picture**
* **Voice over IP**
* **Remote notifications**


### Instantiation

First, import `LSUniversalSDK` and create a `SightCallSDK` variable:

```swift
func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
    guard let _ = (scene as? UIWindowScene),
  		    let window = window
    else { return }
    sightCallSDK = SightCallSDK(window: window)
    /**
    **/
}
```

 Then call `start:` providing the start URL. This, usually, takes place in SceneDelegate:

```swift
func scene(_ scene: UIScene, continue userActivity: NSUserActivity) {
    guard let url = userActivity.webpageURL else { return }
    sightCallSDK?.start(with: url)
}
```



### Running a SightCall Session

Unlike messaging and "phone" applications, users and agents are not connected by their unique identifiers (eg. phone number). Rather, a SightCall Session is initiated by "invitation". This invitation is in the form of a URL which is sent from the Agents Console application.

To test your account and use case you can use the Visual Support App which you can download from the App Store.

NOTE: Apple's Safari Browser is NOT currently supported, use Firefox or Chrome instead and install the SigghtCall browser plugin as directed.

#### Steps

- AGENT: Log on to https://console.sightcall.com/host as the `agent user` you created.
- AGENT: `Start` the session (upper right hand menu option) and send an SMS or email to the user.
- USER: Click on the link (or copy it to the pasteboard)
- USER: If using the pasteboard to pass the invitation URL tap on the "Connect" button in the sample application.



